# 親子マップ 優先順位タスクリスト（MVP基準）

このファイルは「進捗管理チェックリスト.md」を平坦化し、優先度順に並べ替えた実行タスクリストです。MVP（最小実用プロダクト）成立に直結する順で配置しています。各タスクはチェックボックスで進捗管理でき、途中からでも即時に再開できます。

- 参照ドキュメント（根拠）: `基本設計.md:1`, `API設計.md:1`, `DB設計.md:1`, `画面イメージ.drawio:1`
- 参照実装（現状）: `front/src/app/page.tsx:1`, `front/src/app/layout.tsx:1`, `front/src/components/ui/badge.tsx:1`, `back/api/core/views.py:1`, `back/api/config/urls.py:1`, `back/api/config/settings.py:1`

---

## 運用方法
- [ ] を [x] に変更して完了管理します（Git履歴で追跡可能）。
- 行末に「日付/担当/メモ」を自由に追記してください（例: 2025-09-10 担当:田中 メモ: バリデーション追加）。
- 「依存」項目があるタスクは、依存先のタスク完了後に着手してください。

## 優先度の定義
- P0: MVP成立に必須（ブロッカー）。これが終わらないと初回価値提供ができない。
- P1: MVPに強く寄与（次優先）。P0完了後すぐに着手すると効果が高い。
- P2: 改善/拡張。余力で順次着手。

タスクIDは `T-<番号>` で一意に付与しています（指示やIssue連携に利用）。

---

## P0（最優先・ブロッカー）

- [x] T-001 DB拡張の有効化（PostGIS/pg_trgm/citext, ENUM, updated_atトリガ）
  - 内容: `DB設計.md` の初期DDL冒頭に従い、拡張/ENUM/トリガ関数を有効化。
  - 根拠: `DB設計.md:1`

- [x] T-002 DB: 基本テーブル作成（age_bands/categories/features/places/place_features）
  - 内容: 位置情報（geography(Point,4326)）, 生成列lat/lng, search_vector, manual_lock を含む。
  - 依存: T-001
  - 根拠: `DB設計.md:1`

- [x] T-003 DB: 初期データ投入（age_bands, categories, features）
  - 内容: サンプルの年齢帯/カテゴリ/主要featuresをSeedとして投入。
  - 依存: T-002
  - 根拠: `DB設計.md:1`

- [x] T-004 API: CORSの許可設定（Next.js開発オリジン）
  - 内容: `DJANGO_ALLOWED_HOSTS` と `CORS_ALLOWED_ORIGINS` を `.env` と設定に反映。
  - 根拠: `back/api/config/settings.py:1`

- [x] T-005 API: 施設検索 `GET /places`（距離順＋半径フィルタ＋limit＋cursor）
  - 内容: クエリ `lat,lng,radius_m,limit,cursor` を受け、PostGIS KNNで距離順、共通レスポンス `{items,next_cursor}` を返す。
  - 依存: T-001, T-002, T-003, T-004
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [x] T-006 フロント: 一覧のAPI連携（モック除去）
  - 内容: 検索バー/クイックフィルタ入力を `GET /places` に連携して表示を更新。通信エラー時の簡易表示を実装。
  - 依存: T-005
  - 根拠: `画面イメージ.drawio:1`, `基本設計.md:1`

- [x] T-007 フロント: 現在地取得→検索パラメータ適用
  - 内容: `navigator.geolocation` 成功時に `lat/lng` をクエリに適用し再検索（許可ダイアログ/失敗時の文言も実装）。
  - 依存: T-006
  - 根拠: `基本設計.md:1`

- [x] T-008 動作確認: 最小E2E（現在地→距離順リストを取得し表示）
  - 内容: ローカルでDB初期化→API起動→フロント起動→現在地で施設一覧が距離順に並ぶことを確認（5件程度のダミーデータで可）。
  - 依存: T-003, T-005, T-006, T-007

---

## P1（次優先・価値向上）

- [x] T-101 フロント: Google Maps 表示（現在地中心・ピン・クラスタリング）
  - 内容: Maps JavaScript API導入、一覧と地図の相互連動（範囲変更→再検索は将来拡張）。
  - 依存: T-006, T-007
  - 根拠: `基本設計.md:1`

- [x] T-102 フロント: 並び替えUIの連動（距離/総合/件数/新着）
  - 内容: UIから `sort` クエリをAPIに連携。未実装のソートはUI上「準備中」表示でも可。
  - 依存: T-005
  - 根拠: `API設計.md:1`

- [x] T-103 フロント: フィルタドロワー（features 複数選択）→API連動
  - 内容: `features[]` をクエリへ、選択/解除/リセットの状態管理。
  - 依存: T-005
  - 根拠: `API設計.md:1`, `基本設計.md:1`

- [x] T-104 フロント: カーソルページング（無限スクロール）
  - 内容: APIの `next_cursor` と連動して追従読み込み。
  - 依存: T-005
  - 根拠: `API設計.md:1`

- [x] T-105 API: 施設詳細 `GET /places/{id}`（features/rating/photos/sourceメタ）
  - 依存: T-002, T-003
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [x] T-106 API: マスタ参照 `GET /categories`, `GET /features`, `GET /age-bands`
  - 依存: T-003
  - 根拠: `API設計.md:1`

- [x] T-107 API: OpenAPI自動生成と公開（drf-spectacular）
  - 内容: `/schema/` と UI（Swagger/Redoc）の公開。
  - 依存: T-005, T-106
  - 根拠: `API設計.md:1`

- [x] T-108 API: エラーフォーマット統一（code/message/details/trace_id）
  - 内容: 例外ハンドラを差し込み、`API設計.md` の共通仕様に準拠。
  - 根拠: `API設計.md:1`

- [x] T-109 DB: サンプル施設データの投入（テスト用）
  - 内容: 複数カテゴリ/複数featuresをもつ施設を100件投入。
  - 依存: T-003
  - 根拠: `DB設計.md:1`

---

## P2（拡張・将来）

- [x] T-201 認証/アカウント（signup/login/refresh/logout、`GET/PATCH /me`）
  - 根拠: `API設計.md:1`, `基本設計.md:1`

- [x] T-202 レビュー/コメント/参考になった（一覧/投稿/編集/削除/like/コメント）
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [ ] T-203 ブックマーク（保存/解除/自分の一覧）
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [x] T-204 画像アップロード `POST /uploads`（ローカル保存・サイズ制限・EXIF除去/リサイズ）
  - 根拠: `API設計.md:1`

- [ ] T-205 施設修正提案（作成/自分の一覧/審査）
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [ ] T-206 Google連携（取込ジョブ/同期ジョブ/取得元メタ参照）
  - 根拠: `API設計.md:1`, `DB設計.md:1`

- [ ] T-207 place_stats 集計と一覧最適化（平均★/件数/写真数/最終レビュー）
  - 根拠: `DB設計.md:1`

- [ ] T-208 一覧の総合スコア計算（距離/軸/件数/新着/写真の加重）
  - 根拠: `API設計.md:1`

- [ ] T-209 PWA対応（manifest/Service Worker/オフライン時挙動）
  - 根拠: `基本設計.md:1`

- [ ] T-210 運用: 監査ログ/通報/メトリクス/アクセスログ
  - 根拠: `DB設計.md:1`, `API設計.md:1`

---

## 参考: すでに完了している項目（進捗）
- [x] S-001 バック: 疎通用エンドポイント `/api/ping`（DRF）【`back/api/core/views.py:1`, `back/api/config/urls.py:1`】
- [x] S-002 フロント: トップ画面のUIモック（検索/クイックフィルタ/地図プレースホルダ/一覧）【`front/src/app/page.tsx:1`】
- [x] S-003 フロント: レイアウト/Badge UI【`front/src/app/layout.tsx:1`, `front/src/components/ui/badge.tsx:1`】

---

更新履歴:
- 2025-09-10 初版作成（MVP成立に向けたP0→P1→P2の優先度定義とタスクID付与）

