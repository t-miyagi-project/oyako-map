# 親子マップ 開発進捗チェックリスト（設計ドキュメント連動）

このファイルは「基本設計」「画面イメージ」「API設計」「DB設計」を元に、現在の実装状況をチェック式で管理するための進捗台帳です。MVP着地に必要な作業を粒度一定でタスク化し、途中再開しやすいようにセクション別のチェック欄を用意しています。

- 対応ドキュメント（根拠）
  - 基本設計: `基本設計.md:1`
  - 画面イメージ: `画面イメージ.drawio:1`
  - API設計: `API設計.md:1`
  - DB設計: `DB設計.md:1`
- 既存実装（検出済み）
  - フロント: トップ画面のモックUI（検索・クイックフィルタ・地図プレースホルダ・一覧） `front/src/app/page.tsx:1`
  - フロント: レイアウトとBadge UI `front/src/app/layout.tsx:1`, `front/src/components/ui/badge.tsx:1`
  - バック: Django/DRF最小構成と疎通 `back/api/config/urls.py:1`, `back/api/core/views.py:1`

---

## 使い方
- [ ] を [x] に書き換えると「完了」扱いになります（Gitで履歴管理）。
- 行末に任意でメモを追記してください（例: 2025-09-10 担当:山田、補足: APIのバリデーション追加）。
- セクションの親タスクは「下位が全て完了」した時にチェックしてください。
- タスクは必要に応じて随時追加/分割可（このファイルを真実のソースにする）。

---

## 0. 全体運用
- [ ] 用語/命名の統一（UIは「サービス」、DB/APIは features を使用）【根拠: `DB設計.md:1`】
- [ ] バージョニング方針の確認（API `/v1`、破壊的変更はメジャー）【根拠: `API設計.md:1`】
- [ ] 環境変数・シークレット運用ルール（API鍵、DB接続、JWT）整理
- [ ] エラーポリシー/レスポンス形式の統一（`error.code/message/details/trace_id`）【根拠: `API設計.md:1`】
- [ ] レート制限の初期値確定（検索30 req/min、全体60 req/min）【根拠: `API設計.md:1`】

---

## 1. 基本設計（要件定義）
- [ ] スコープ確定（対象施設・PWA・位置情報同意・GMP利用）【根拠: `基本設計.md:1`】
- [ ] ペルソナ確定（0-1, 2-6, 低学年）【根拠: `基本設計.md:1`】
- [ ] ユースケース定義の精緻化（距離→詳細→経路、検索/絞り込み、レビュー）【根拠: `基本設計.md:1`】
- [ ] 子連れ向け評価軸の確定（重み・年齢帯重み拡張方針）【根拠: `基本設計.md:1`】
- [ ] 外部連携の前提整理（Google Maps、画像保存ローカル、Place ID）【根拠: `基本設計.md:1`】

---

## 2. 画面（UI/UX）

### 2.1 トップ画面（地図＋近い順リスト）
- [x] 検索バー＋クイックフィルタの配置（UIモック）【実装: `front/src/app/page.tsx:1`】
- [x] 地図プレースホルダと現在地取得の呼び出し枠【実装: `front/src/app/page.tsx:1`】
- [x] 施設一覧（距離順・サービスバッジ・簡易★）のモック表示【実装: `front/src/app/page.tsx:1`】
- [ ] Google Maps 表示（クラスタリング、現在地中心）
- [ ] 並び替え（距離/総合/件数/新着）UIと連動
- [ ] フィルタドロワー（features 複数選択）UI
- [ ] レスポンシブ最適化（モバイル優先/スクロール挙動）

### 2.2 検索結果一覧
- [ ] 検索パラメータのURL同期（q, category, features[], sort）
- [ ] 無限スクロール or ページング（cursor連動）

### 2.3 施設詳細
- [ ] 基本情報（名称/住所/TEL/URL/営業時間/価格帯/写真）
- [ ] 子連れアイコン群（バッジ＋ツールチップ）
- [ ] レビュー（平均★、分布、最新数件）
- [ ] 経路リンク（Google Directions）

### 2.4 レビュー投稿
- [ ] 軸ごとの★、年齢帯、写真（最大5枚）、所要時間、再訪意向
- [ ] 画像アップロード（ドラッグ＆ドロップ/プレビュー/削除）

### 2.5 認証/プロフィール
- [ ] サインアップ/ログイン/ログアウトフロー
- [ ] プロフィール編集（ニックネーム/居住エリア/年齢帯）

### 2.6 管理画面（最小）
- [ ] 施設CRUD、サービス編集
- [ ] 修正提案の審査（承認/却下）

---

## 3. API（Django REST Framework）

### 3.0 基盤
- [x] 疎通用エンドポイント `/api/ping`【実装: `back/api/core/views.py:1`】
- [ ] OpenAPI（drf-spectacular 等）自動生成と公開
- [ ] 共通エラーハンドリング/トレースID付与
- [ ] カーソルページングの共通レスポンス（`items`, `next_cursor`）【根拠: `API設計.md:1`】

### 3.1 認証/アカウント
- [ ] `POST /auth/signup`（メール検証は将来）
- [ ] `POST /auth/login`（JWT発行）
- [ ] `POST /auth/refresh` / `POST /auth/logout`
- [ ] `GET/PATCH /me`

### 3.2 マスタ
- [ ] `GET /categories`
- [ ] `GET /features`
- [ ] `GET /age-bands`

### 3.3 施設（Places）
- [ ] `GET /places`（距離・検索・features・ソート・cursor）
- [ ] `GET /places/{id}`（features/rating/photos/sourceメタ）
- [ ] `POST /places`（ADMIN）
- [ ] `PATCH /places/{id}`（ADMIN/MOD; `manual_lock`）
- [ ] `PUT /places/{id}/features`（一括置換）

### 3.4 レビュー/コメント/参考になった
- [ ] `GET /places/{id}/reviews?sort=new|helpful`
- [ ] `POST /reviews` / `PATCH /reviews/{id}` / `DELETE /reviews/{id}`
- [ ] `POST/DELETE /reviews/{id}/like`
- [ ] `GET /reviews/{id}/comments` / `POST /comments` / `PATCH|DELETE /comments/{id}`

### 3.5 ブックマーク
- [ ] `GET /me/bookmarks` / `POST /bookmarks` / `DELETE /bookmarks/{placeId}`

### 3.6 施設修正提案
- [ ] `POST /place-suggestions`
- [ ] `GET /me/place-suggestions`
- [ ] `GET /admin/place-suggestions` / `PATCH /admin/place-suggestions/{id}`（approve/reject）

### 3.7 Google連携（管理ジョブ）
- [ ] `POST /admin/places/import-by-place-id`
- [ ] `GET /admin/sync-jobs` / `GET /admin/sync-jobs/{id}` / `PATCH /admin/sync-jobs/{id}`
- [ ] `GET /admin/places/{id}/source-meta`

### 3.8 画像アップロード
- [ ] `POST /uploads`（multipart/form-data、目的: review_photo|place_photo）

---

## 4. データベース（PostgreSQL + PostGIS）

### 4.0 初期設定
- [ ] PostGIS/pg_trgm/citext 拡張の有効化
- [ ] ENUM型（user_role/review_status/report_status/data_source/sync_status/suggestion_status）作成
- [ ] updated_at トリガ関数の作成

### 4.1 マスタ/基幹テーブル
- [ ] `age_bands` / `categories` / `features` / `review_axes`
- [ ] `users`（外部Auth連携前提のフィールド設計）
- [ ] `places`（`geog`/生成列lat,lng/`google_place_id`/`manual_lock`/`search_vector`）
- [ ] `place_features`（複合PK）

### 4.2 コンテンツ/アクション系
- [ ] `reviews` / `review_scores`
- [ ] `comments` / `review_likes` / `bookmarks`
- [ ] `photos`（XOR 制約、place/review 片方必須）
- [ ] `reports` / `audit_logs`

### 4.3 集計/同期
- [ ] `place_stats`（平均★/件数/写真数/最終レビュー時刻）
- [ ] `place_source_meta`（取得原本・etag・fetched_at）
- [ ] `place_sync_jobs`（queued/running/succeeded/failed）
- [ ] `place_suggestions`（提案・審査メタ）

### 4.4 インデックス/検索最適化
- [ ] GIST（`places.geog`）/ tsベクタ GIN / 代表インデックス
- [ ] 距離順クエリ/サービス絞り込みSQLの検証（KNN / EXISTS）

### 4.5 初期データ
- [ ] 年齢帯/カテゴリ/代表features のシード投入

---

## 5. 外部連携・アルゴリズム
- [ ] Google Maps（JS API, Geocoding, Directions Link）の実装
- [ ] 一覧の総合スコア計算（距離/子連れ軸/件数/新着/写真）【根拠: `API設計.md:1`】
- [ ] 年齢帯の重み付け拡張（将来）

---

## 6. 品質/運用
- [ ] PWA（manifest/Service Worker/オフライン時の挙動）
- [ ] 画像処理（EXIF除去/リサイズ/保存先 `/media/...`）【根拠: `API設計.md:1`】
- [ ] 監査ログ/通報（最低限のUI/管理導線）
- [ ] モニタリング/メトリクス/アクセスログ整備

---

## 7. 既存実装のメモ（参考）
- フロント
  - `front/src/app/page.tsx:1` トップ画面のUIモック（検索/クイックフィルタ/地図プレースホルダ/一覧/★表示）
  - `front/src/app/layout.tsx:1` HTML骨格/メタデータ
  - `front/src/components/ui/badge.tsx:1` バッジコンポーネント（variantあり）
- バックエンド
  - `back/api/core/views.py:1` Pingエンドポイント（疎通確認）
  - `back/api/config/settings.py:1` DRF/CORS/DB設定のひな形

---

## 8. 次にやると良い具体アクション（MVP順）
- [ ] DB: `places`/`categories`/`features`/`place_features` を最小でマイグレーション→Seed投入
- [ ] API: `GET /places` 距離順（lat/lng/radius/limit/cursor）を先行実装
- [ ] フロント: トップ画面の一覧をAPI連携に切替（モック除去）
- [ ] フロント: Google Maps 表示（現在地中心・ピン）
- [ ] API: 画像アップロード `POST /uploads`（ローカル保存、最大サイズ制限）
- [ ] レビュー投稿の最小版（overall/age_band/scores[] のみ）

---

更新履歴メモ（任意）：
- 2025-09-10 初版作成（設計ドキュメント v0.2 反映、既存実装検知分チェック）

